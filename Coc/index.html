<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CoC Builder Tracker</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #121212;
    color: #f2f2f2;
    padding: 2rem;
    max-width: 700px;
    margin: auto;
  }
  h1 { text-align: center; color: #ff5264; }
  .builder {
    background: #222;
    border-radius: 1rem;
    padding: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 0 8px rgba(0,0,0,0.5);
  }
  label { display: block; margin: .3rem 0; }
  input {
    width: 100%;
    padding: .4rem;
    margin-bottom: .5rem;
    border: none;
    border-radius: .5rem;
  }
  button {
    background: #cd3244;
    color: white;
    border: none;
    padding: .6rem 1rem;
    border-radius: .5rem;
    cursor: pointer;
    transition: background 0.2s;
  }
  button:hover { background: #991c2c; }
  #potions {
    margin: 1rem 0;
    text-align: center;
  }
  #boost-status {
    text-align: center;
    margin-top: 1rem;
    color: #d2d2d2;
  }
</style>
</head>
<body>
<h1>Clash of Clans Builder Tracker</h1>

<div id="builders"></div>

<div id="potions">
  <label>Builder Potions Used:</label>
  <input type="number" id="potionCount" min="1" max="100" value="1">
  <button onclick="startPotion()">Activate Potion</button>
</div>

<div id="boost-status">No active boost</div>

<script>
const builderCount = 6;
const potionBoost = 10; // 10x speed means 10 builder-hours per real hour
const storageKey = "builderTrackerData";
const boostKey = "activeBoost";

function loadBuilders() {
  const data = JSON.parse(localStorage.getItem(storageKey)) || [];
  const container = document.getElementById("builders");
  container.innerHTML = "";
  for (let i = 0; i < builderCount; i++) {
    const b = data[i] || { name: "", hours: "" };
    const div = document.createElement("div");
    div.className = "builder";
    div.innerHTML = `
      <h3>Builder ${i + 1}</h3>
      <label>Project Name:</label>
      <input type="text" id="name${i}" value="${b.name}">
      <label>Remaining Time (hours):</label>
      <input type="number" id="hours${i}" value="${b.hours}" min="0">
      <button onclick="saveBuilder(${i})">Save</button>
    `;
    container.appendChild(div);
  }
}

function saveBuilder(i) {
  const name = document.getElementById(`name${i}`).value;
  const hours = parseFloat(document.getElementById(`hours${i}`).value) || 0;
  const data = JSON.parse(localStorage.getItem(storageKey)) || [];
  data[i] = { name, hours };
  localStorage.setItem(storageKey, JSON.stringify(data));
  alert(`Builder ${i + 1} saved!`);
}

function startPotion() {
  const m = parseFloat(document.getElementById("potionCount").value) || 1;
  const totalDuration = m * 60 * 60 * 1000; // convert to milliseconds
  const endTime = Date.now() + totalDuration;
  localStorage.setItem(boostKey, JSON.stringify({ endTime, m }));
  updateBoostStatus();
}

function updateBoostStatus() {
  const boost = JSON.parse(localStorage.getItem(boostKey));
  const status = document.getElementById("boost-status");

  if (!boost) {
    status.textContent = "No active boost";
    return;
  }

  const remaining = boost.endTime - Date.now();
  if (remaining <= 0) {
    localStorage.removeItem(boostKey);
    status.textContent = "Boost expired";
    return;
  }

  const hoursLeft = (remaining / 3600000).toFixed(2);
  status.textContent = `Boost Active: 10Ã— speed for ${hoursLeft}h remaining`;

  // Apply boost effect gradually
  applyRealTimeBoost(boost.m);

  requestAnimationFrame(updateBoostStatus);
}

function applyRealTimeBoost(m) {
  // calculate time passed since last update and reduce builder hours
  const lastUpdateKey = "lastUpdateTime";
  const now = Date.now();
  const lastUpdate = parseFloat(localStorage.getItem(lastUpdateKey)) || now;
  const elapsedMs = now - lastUpdate;
  localStorage.setItem(lastUpdateKey, now);

  const elapsedHours = elapsedMs / 3600000; // real hours passed
  const acceleratedHours = elapsedHours * potionBoost; // 10x speed

  const data = JSON.parse(localStorage.getItem(storageKey)) || [];
  let changed = false;

  for (let i = 0; i < data.length; i++) {
    if (!data[i]) continue;
    let R = parseFloat(data[i].hours) || 0;
    if (R > 0) {
      R = Math.max(R - acceleratedHours, 0);
      data[i].hours = R.toFixed(2);
      changed = true;
    }
  }

  if (changed) localStorage.setItem(storageKey, JSON.stringify(data));
  if (changed) loadBuilders();
}

window.onload = () => {
  loadBuilders();
  updateBoostStatus();
};
</script>
</body>
</html>
