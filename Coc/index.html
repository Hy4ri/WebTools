<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CoC Builder Tracker</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #121212;
    color: #f2f2f2;
    padding: 2rem;
    max-width: 700px;
    margin: auto;
  }
  h1 {
    text-align: center;
    color: #990000;
  }
  .builder {
    background: #1e1e1e;
    border-radius: 1rem;
    padding: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 0 8px rgba(0,0,0,0.6);
  }
  label { display: block; margin: .3rem 0; }
  input {
    width: 32%;
    padding: .4rem;
    margin-right: .3rem;
    border: none;
    border-radius: .5rem;
    background: #222;
    color: #f2f2f2;
    text-align: center;
  }
  button {
    background: #990000;
    color: white;
    border: none;
    padding: .6rem 1rem;
    border-radius: .5rem;
    cursor: pointer;
    transition: background 0.2s;
  }
  button:hover { background: #660000; }
  #potions {
    margin: 1rem 0;
    text-align: center;
  }
  #boost-status {
    text-align: center;
    margin-top: 1rem;
    color: #d2d2d2;
  }
  .time-display {
    margin-top: .5rem;
    color: #aaa;
    font-size: 0.9rem;
  }
</style>
</head>
<body>
<h1>Clash of Clans Builder Tracker</h1>

<div id="builders"></div>

<div id="potions">
  <label>Builder Potions Used:</label>
  <input type="number" id="potionCount" min="1" max="100" value="1">
  <button onclick="startPotion()">Activate Potion</button>
</div>

<div id="boost-status">No active boost</div>

<script>
const builderCount = 6;
const potionBoost = 10;
const storageKey = "builderTrackerData";
const boostKey = "activeBoost";

function loadBuilders() {
  const data = JSON.parse(localStorage.getItem(storageKey)) || [];
  const container = document.getElementById("builders");
  container.innerHTML = "";
  for (let i = 0; i < builderCount; i++) {
    const b = data[i] || { name: "", totalHours: 0, remaining: 0 };
    const div = document.createElement("div");
    div.className = "builder";
    div.innerHTML = `
      <h3>Builder ${i + 1}</h3>
      <label>Project Name:</label>
      <input type="text" id="name${i}" value="${b.name}">
      <label>Total Time:</label>
      <div>
        <input type="number" id="days${i}" placeholder="Days" value="${Math.floor(b.totalHours / 24) || ""}">
        <input type="number" id="hours${i}" placeholder="Hours" value="${Math.floor(b.totalHours % 24) || ""}">
        <input type="number" id="minutes${i}" placeholder="Minutes" value="${Math.floor((b.totalHours * 60) % 60) || ""}">
      </div>
      <button onclick="saveBuilder(${i})">Save</button>
      <div class="time-display" id="remaining${i}">
        Remaining: ${formatTime(b.remaining || 0)}<br>
        Total: ${formatTime(b.totalHours || 0)}
      </div>
    `;
    container.appendChild(div);
  }
}

function saveBuilder(i) {
  const name = document.getElementById(`name${i}`).value;
  const days = parseFloat(document.getElementById(`days${i}`).value) || 0;
  const hours = parseFloat(document.getElementById(`hours${i}`).value) || 0;
  const minutes = parseFloat(document.getElementById(`minutes${i}`).value) || 0;
  const totalHours = days * 24 + hours + minutes / 60;
  const data = JSON.parse(localStorage.getItem(storageKey)) || [];
  data[i] = { name, totalHours, remaining: totalHours };
  localStorage.setItem(storageKey, JSON.stringify(data));
  loadBuilders();
}

function formatTime(hours) {
  const totalMinutes = Math.floor(hours * 60);
  const d = Math.floor(totalMinutes / (60 * 24));
  const h = Math.floor((totalMinutes % (60 * 24)) / 60);
  const m = totalMinutes % 60;
  return `${d}d ${h}h ${m}m`;
}

function startPotion() {
  const m = parseFloat(document.getElementById("potionCount").value) || 1;
  const duration = m * 60 * 60 * 1000;
  const endTime = Date.now() + duration;
  localStorage.setItem(boostKey, JSON.stringify({ endTime, m }));
  updateBoostStatus();
}

function updateBoostStatus() {
  const boost = JSON.parse(localStorage.getItem(boostKey));
  const status = document.getElementById("boost-status");
  if (!boost) {
    status.textContent = "No active boost";
    return;
  }
  const remaining = boost.endTime - Date.now();
  if (remaining <= 0) {
    localStorage.removeItem(boostKey);
    status.textContent = "Boost expired";
    return;
  }
  const hoursLeft = (remaining / 3600000).toFixed(2);
  status.textContent = `Boost Active: 10Ã— speed for ${hoursLeft}h remaining`;
  applyRealTimeBoost();
  requestAnimationFrame(updateBoostStatus);
}

function applyRealTimeBoost() {
  const boost = JSON.parse(localStorage.getItem(boostKey));
  if (!boost) return;

  const lastUpdateKey = "lastUpdateTime";
  const now = Date.now();
  const lastUpdate = parseFloat(localStorage.getItem(lastUpdateKey)) || now;
  const elapsedMs = now - lastUpdate;
  localStorage.setItem(lastUpdateKey, now);

  const elapsedHours = elapsedMs / 3600000;
  const accelerated = elapsedHours * potionBoost;

  const data = JSON.parse(localStorage.getItem(storageKey)) || [];
  let changed = false;
  for (let i = 0; i < data.length; i++) {
    if (!data[i]) continue;
    let R = parseFloat(data[i].remaining) || 0;
    if (R > 0) {
      R = Math.max(R - accelerated, 0);
      data[i].remaining = R;
      changed = true;
    }
  }
  if (changed) {
    localStorage.setItem(storageKey, JSON.stringify(data));
    refreshRemainingDisplay(data);
  }
}

function refreshRemainingDisplay(data) {
  for (let i = 0; i < data.length; i++) {
    const div = document.getElementById(`remaining${i}`);
    if (!div || !data[i]) continue;
    div.innerHTML = `
      Remaining: ${formatTime(data[i].remaining || 0)}<br>
      Total: ${formatTime(data[i].totalHours || 0)}
    `;
  }
}

window.onload = () => {
  loadBuilders();
  updateBoostStatus();
  setInterval(() => {
    applyRealTimeBoost();
  }, 60000);
};
</script>
</body>
</html>
