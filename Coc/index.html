<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CoC Builder Tracker</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #121212;
    color: #f2f2f2;
    padding: 2rem;
    max-width: 750px;
    margin: auto;
  }
  h1 { text-align: center; color: #ff5264; }
  .builder {
    background: #222;
    border-radius: 1rem;
    padding: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 0 8px rgba(0,0,0,0.5);
  }
  .time-inputs {
    display: flex;
    gap: 0.5rem;
    justify-content: space-between;
  }
  .time-inputs input {
    width: 30%;
    padding: .4rem;
    border: none;
    border-radius: .5rem;
    text-align: center;
  }
  label { display: block; margin: .3rem 0; }
  button {
    background: #cd3244;
    color: white;
    border: none;
    padding: .6rem 1rem;
    border-radius: .5rem;
    cursor: pointer;
    transition: background 0.2s;
    margin-top: 0.4rem;
  }
  button:hover { background: #991c2c; }
  #potions {
    margin: 1rem 0;
    text-align: center;
  }
  #boost-status {
    text-align: center;
    margin-top: 1rem;
    color: #d2d2d2;
  }
</style>
</head>
<body>
<h1>Clash of Clans Builder Tracker</h1>

<div id="builders"></div>

<div id="potions">
  <label>Builder Potions Used:</label>
  <input type="number" id="potionCount" min="1" max="100" value="1">
  <button onclick="startPotion()">Activate Potion</button>
</div>

<div id="boost-status">No active boost</div>

<script>
const builderCount = 6;
const potionBoost = 10; // 10× speed = 10 builder-hours per real hour
const storageKey = "builderTrackerData";
const boostKey = "activeBoost";
const lastUpdateKey = "lastUpdateTime";

// Utility conversions
function hToMs(h) { return h * 3600000; }
function msToH(ms) { return ms / 3600000; }
function timeToHours(d, h, m) { return d*24 + h + m/60; }
function hoursToTime(h) {
  const days = Math.floor(h / 24);
  const hours = Math.floor(h % 24);
  const mins = Math.floor((h * 60) % 60);
  return { days, hours, mins };
}

function loadBuilders() {
  const data = JSON.parse(localStorage.getItem(storageKey)) || [];
  const container = document.getElementById("builders");
  container.innerHTML = "";

  for (let i = 0; i < builderCount; i++) {
    const b = data[i] || { name: "", hours: 0 };
    const t = hoursToTime(parseFloat(b.hours) || 0);

    const div = document.createElement("div");
    div.className = "builder";
    div.innerHTML = `
      <h3>Builder ${i + 1}</h3>
      <label>Project Name:</label>
      <input type="text" id="name${i}" value="${b.name}">
      <label>Remaining Time:</label>
      <div class="time-inputs">
        <input type="number" id="days${i}" value="${t.days}" min="0" placeholder="Days">
        <input type="number" id="hours${i}" value="${t.hours}" min="0" max="23" placeholder="Hours">
        <input type="number" id="mins${i}" value="${t.mins}" min="0" max="59" placeholder="Mins">
      </div>
      <button onclick="saveBuilder(${i})">Save</button>
      <p id="display${i}"></p>
    `;
    container.appendChild(div);
  }
}

function saveBuilder(i) {
  const name = document.getElementById(`name${i}`).value;
  const d = parseFloat(document.getElementById(`days${i}`).value) || 0;
  const h = parseFloat(document.getElementById(`hours${i}`).value) || 0;
  const m = parseFloat(document.getElementById(`mins${i}`).value) || 0;
  const totalHours = timeToHours(d, h, m);

  const data = JSON.parse(localStorage.getItem(storageKey)) || [];
  data[i] = { name, hours: totalHours };
  localStorage.setItem(storageKey, JSON.stringify(data));
  alert(`Builder ${i + 1} saved!`);
}

function startPotion() {
  const m = parseInt(document.getElementById("potionCount").value) || 1;
  const totalDuration = hToMs(m); // 1 potion = 1 hour duration
  const endTime = Date.now() + totalDuration;
  localStorage.setItem(boostKey, JSON.stringify({ endTime }));
  localStorage.setItem(lastUpdateKey, Date.now());
  updateBoostStatus();
}

function updateBoostStatus() {
  const boost = JSON.parse(localStorage.getItem(boostKey));
  const status = document.getElementById("boost-status");

  if (!boost) {
    status.textContent = "No active boost";
    return;
  }

  const remaining = boost.endTime - Date.now();
  if (remaining <= 0) {
    localStorage.removeItem(boostKey);
    status.textContent = "Boost expired";
    return;
  }

  const hoursLeft = (remaining / 3600000).toFixed(2);
  status.textContent = `Boost Active: 10× speed for ${hoursLeft}h remaining`;
  applyRealTimeBoost();
  requestAnimationFrame(updateBoostStatus);
}

function applyRealTimeBoost() {
  const now = Date.now();
  const lastUpdate = parseFloat(localStorage.getItem(lastUpdateKey)) || now;
  const elapsedMs = now - lastUpdate;
  localStorage.setItem(lastUpdateKey, now);

  const elapsedHours = msToH(elapsedMs);
  const acceleratedHours = elapsedHours * potionBoost; // 10× progress

  const data = JSON.parse(localStorage.getItem(storageKey)) || [];
  let changed = false;

  for (let i = 0; i < data.length; i++) {
    if (!data[i]) continue;
    let R = parseFloat(data[i].hours) || 0;
    if (R > 0) {
      R = Math.max(R - acceleratedHours, 0);
      data[i].hours = R;
      changed = true;
      const t = hoursToTime(R);
      const display = document.getElementById(`display${i}`);
      if (display)
        display.textContent = `Remaining: ${t.days}d ${t.hours}h ${t.mins}m`;
    }
  }

  if (changed) localStorage.setItem(storageKey, JSON.stringify(data));
}

window.onload = () => {
  loadBuilders();
  updateBoostStatus();
  setInterval(() => {
    // update timers even if boost inactive
    const data = JSON.parse(localStorage.getItem(storageKey)) || [];
    for (let i = 0; i < data.length; i++) {
      const R = parseFloat(data[i]?.hours || 0);
      const t = hoursToTime(R);
      const display = document.getElementById(`display${i}`);
      if (display)
        display.textContent = `Remaining: ${t.days}d ${t.hours}h ${t.mins}m`;
    }
  }, 1000);
};
</script>
</body>
</html>
